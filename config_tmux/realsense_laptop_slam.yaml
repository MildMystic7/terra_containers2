session_name: docker_session
environment:
 CONTAINER_NAME: "docker-realsense_ros2-1"
shell_command_before:
  - xhost +local:docker
  - docker exec -it $CONTAINER_NAME bash
  - . /opt/ros/humble/setup.bash 
windows:
  - window_name: Main panel
    layout: tiled
    panes:
      - shell_command:
        # Realsense node
        - ros2 launch realsense2_camera rs_launch.py enable_gyro:=true enable_accel:=true enable_infra1:=true enable_infra2:=true unite_imu_method:="2" rgb_camera.color_profile:='1280,720,15' depth_module.infra_profile:='848,480,15' depth_module.depth_profile:='848,480,15' pointcloud.enable:=true
      - shell_command:
        # Disable IR emitter
        - sleep 5
        - ros2 param set /camera/camera depth_module.emitter_on_off true
        - ros2 param set /camera/camera filter_by_sequence_id.enable true
        - ros2 param set /camera/camera filter_by_sequence_id.sequence_id 2
        # Start SLAM node
        - colcon build --packages-select orbslam3
        - . install/setup.bash
        # - ros2 launch ov_msckf subscribe.launch.py config:=terra_d455
        - ros2 run orbslam3 stereo src/orbslam3_ros2/vocabulary/ORBvoc.txt src/orbslam3_ros2/config/stereo/terra_D455.yaml false
      - shell_command:
        # Record bag
        - cd /data
        # - record_cmd="ros2 bag record /camera/camera/infra1/image_rect_raw /camera/camera/infra2/image_rect_raw /camera/camera/depth/image_rect_raw /camera/camera/color/image_raw /camera/camera/imu /tf /tf_static"
        - record_cmd="ros2 bag record /camera/camera/infra1/image_rect_raw /camera/camera/infra2/image_rect_raw /camera/camera/depth/image_rect_raw /camera/camera/color/image_raw /camera/camera/gyro/sample /camera/camera/accel/sample /tf /tf_static /camera/camera/depth/color/points"
        - read -e -p "${PS1@P}" -i "$record_cmd" cmd; bash -c "$cmd"
      - shell_command:
        - colcon build --packages-select segmentation
        - . install/setup.bash
        - ros2 run segmentation segment_ndvi
  - window_name: Ros nodes
    layout: tiled
    panes:
      - shell_command:
        - rviz2 -d ./config_rviz/slam.rviz
        # - ros2 run tf2_ros static_transform_publisher 0 0 0 0.5 -0.5 0.5 0.5 cam0 camera_link
  
global_options:
  mouse: on